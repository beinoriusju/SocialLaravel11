# Update and upgrade system packages
sudo apt update
sudo apt upgrade -y

# Install Nginx
sudo apt install nginx -y

# Allow Nginx through the firewall
sudo ufw allow 'Nginx Full'

# Install PHP 8.3 and necessary PHP extensions
sudo apt install php8.3 php8.3-fpm php8.3-mbstring php8.3-gd php8.3-xml php8.3-cli php8.3-zip php8.3-curl php8.3-intl php8.3-bcmath php8.3-mysql php8.3-soap php8.3-ldap php8.3-imap php8.3-opcache php8.3-redis php8.3-sqlite3 -y

# Configure PHP
sudo nano /etc/php/8.3/fpm/php.ini

# Restart PHP 8.3-FPM service
sudo systemctl restart php8.3-fpm

# Install MySQL server
sudo apt install mysql-server -y

# Configure MySQL root user with native password authentication
sudo mysql
ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'Ktz235N788??';
exit

# Test MySQL root login
sudo mysql_secure_installation
sudo mysql -p
CREATE DATABASE laravelexample CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
exit

#Install project
cd /var/www/
git clone https://github.com/Vaidas393/SocialLaravel11.git laravelexample

# Set directory permissions for the Laravel application
cd /var/www/
sudo chgrp -R www-data /var/www/laravelexample
sudo chmod -R 775 /var/www/laravelexample/storage/

# Install Composer
php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
php -r "if (hash_file('sha384', 'dac665fdc30fdd8ec78b38b9800061b4150413ff2e3b6f88543c636f7cd84f6db9189d43a81e5503cda447da73c7e5b6') { echo 'Installer verified'; } else { echo 'Installer corrupt'; unlink('composer-setup.php'); } echo PHP_EOL;"
php composer-setup.php
php -r "unlink('composer-setup.php');"
sudo mv composer.phar /usr/local/bin/composer

# Install Laravel dependencies and set up environment
cd /var/www/laravelexample
composer install
composer update
php artisan key:generate
php artisan storage:link
php artisan migrate

# Nginx site configuration for Laravel
sudo nano /etc/nginx/sites-available/laravelexample

# Paste the following configuration into the file
server {
    listen 80;
    server_name vpsocial.site;
    root /var/www/laravelexample/public;

    index index.php index.html index.htm;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/var/run/php/php8.3-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }

    location ~ /\.ht {
        deny all;
    }
}

# Enable the Nginx configuration and test it
sudo ln -s /etc/nginx/sites-available/laravelexample /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx

# Install Certbot for SSL certificate management
sudo apt install certbot python3-certbot-nginx -y

# Obtain and configure SSL certificate for Nginx
sudo certbot --nginx -d vpsocial.site

# Install Node.js and npm
cd /
curl -fsSL https://deb.nodesource.com/setup_23.x -o nodesource_setup.sh
sudo -E bash nodesource_setup.sh
sudo apt install -y nodejs

# Build Laravel front-end assets
cd /var/www/laravelexample
npm install
npm run build


Instal my admin
sudo apt update
sudo apt install phpmyadmin -y
sudo nano /etc/nginx/sites-available/phpmyadmin


server {
    listen 80;
    server_name vpsocial.site;

    # phpMyAdmin location block
    location /phpmyadmin {
        alias /usr/share/phpmyadmin;  # Point to the phpMyAdmin installation directory
        index index.php index.html index.htm;

        # Handle PHP requests within phpMyAdmin
        location ~ ^/phpmyadmin/(.+\.php)$ {
            fastcgi_pass unix:/var/run/php/php8.3-fpm.sock;  # Ensure this matches your PHP version
            fastcgi_index index.php;
            fastcgi_param SCRIPT_FILENAME /usr/share/phpmyadmin/$1;
            include fastcgi_params;
        }

        # Deny access to .htaccess files
        location ~ ^/phpmyadmin/(.+\.ht) {
            deny all;
        }
    }
}

sudo nginx -t
sudo systemctl restart nginx
http://vpsocial.site/phpmyadmin

Instal file manager

cd /var/www/
sudo mkdir filemanager
cd filemanager
sudo wget https://raw.githubusercontent.com/prasathmani/tinyfilemanager/master/tinyfilemanager.php
sudo chown -R www-data:www-data /var/www/filemanager
sudo chmod -R 755 /var/www/filemanager
sudo nano /etc/nginx/sites-available/filemanager

server {
    listen 80;
    server_name vpsocial.site;

    # Tiny File Manager location block
    location /filemanager {
        alias /var/www/filemanager;  # Point to Tiny File Manager directory
        index tinyfilemanager.php;

        # Handle PHP requests within filemanager
        location ~ ^/filemanager/(.+\.php)$ {
            fastcgi_pass unix:/var/run/php/php8.3-fpm.sock;  # Ensure this matches your PHP version
            fastcgi_index tinyfilemanager.php;
            fastcgi_param SCRIPT_FILENAME /var/www/filemanager/$1;
            include fastcgi_params;
        }

        # Deny access to sensitive files
        location ~ ^/filemanager/(.+\.(ht|json|yml|xml|md)) {
            deny all;
        }
    }
}

sudo ln -s /etc/nginx/sites-available/filemanager /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
sudo nano /var/www/filemanager/tinyfilemanager.php

$auth_users = [
    'admin' => password_hash('Ktz235N788??', PASSWORD_BCRYPT) // Replace 'mypassword' with your actual password
];

$root_path = '/var/www/laravelexample';

sudo chown -R www-data:www-data /var/www/laravelexample
sudo chmod -R 755 /var/www/laravelexample
http://vpsocial.site/filemanager
